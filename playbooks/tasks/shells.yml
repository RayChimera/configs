---
- name: Install a chosen shell
  become: true
  ansible.builtin.apt:
    pkg:
      - "{{ shell }}"
    state: latest

- name: Ensure fonts directory exists
  ansible.builtin.file:
    path: "/usr/local/share/fonts/m/"
    state: directory

- name: MesloLGS exists
  become: true
  ansible.builtin.shell: "touch -a /usr/local/share/fonts/m/ && ls /usr/local/share/fonts/m/MesloLGS_NF_*"
  register: meslo_lgs_exists

- name: Download MesloLGS
  when: meslo_lgs_exists is failed
  become: true
  ansible.builtin.get_url:
    url: "{{ item.url }}"
    dest: "{{ item.dest }}"
  loop:
    - {
        url: "https://github.com/IlanCosman/tide/blob/assets/fonts/mesloLGS_NF_regular.ttf?raw=true",
        dest: "/usr/local/share/fonts/m/MesloLGS_NF_regular.ttf",
      }
    - {
        url: "https://github.com/IlanCosman/tide/blob/assets/fonts/mesloLGS_NF_bold.ttf?raw=true",
        dest: "/usr/local/share/fonts/m/MesloLGS_NF_bold.ttf",
      }
    - {
        url: "https://github.com/IlanCosman/tide/blob/assets/fonts/mesloLGS_NF_italic.ttf?raw=true",
        dest: "/usr/local/share/fonts/m/MesloLGS_NF_italic.ttf",
      }
    - {
        url: "https://github.com/IlanCosman/tide/blob/assets/fonts/mesloLGS_NF_bold_italic.ttf?raw=true",
        dest: "/usr/local/share/fonts/m/MesloLGS_NF_bold_italic.ttf",
      }

- name: Setup terminal
  ansible.builtin.meta: noop # TODO Actually setup terminal (for real)

- name: Configure zsh
  ansible.builtin.import_tasks:
    file: tasks/subtasks/zsh.yml
  when: shell == "zsh"

- name: Configure fish
  ansible.builtin.import_tasks:
    file: tasks/subtasks/fish.yml
  when: shell == "fish"

- name: Set default shell
  become: true
  ansible.builtin.shell: "chsh -s /usr/bin/{{ shell }} {{ username }}"
